from py2neo import Graph

# Connessione a Neo4j
graph = Graph("bolt://localhost:7688", auth=("neo4j", "scottdirT98"))


def delete_metasploit_data():
    try:
        # Elimina le relazioni tra MetasploitScript e altri nodi
        graph.run("MATCH (ms:MetasploitScript)-[r]->() DELETE r")
        graph.run("MATCH ()-[r]->(ms:MetasploitScript) DELETE r")

        # Elimina i nodi MetasploitScript
        graph.run("MATCH (ms:MetasploitScript) DELETE ms")

        graph.run("MATCH (ms:MetasploitDescription) DELETE ms")

        # Elimina i nodi Author senza relazioni
        graph.run("MATCH (a:Author) WHERE NOT (a)-[]-() DELETE a")

        # Elimina i nodi License senza relazioni
        graph.run("MATCH (l:License) WHERE NOT (l)-[]-() DELETE l")

        graph.run("MATCH (l:References) WHERE NOT (l)-[]-() DELETE l")

        # Elimina i nodi Privileged senza relazioni
        graph.run("MATCH (p:Privileged) WHERE NOT (p)-[]-() DELETE p")

        # Elimina i nodi Platform senza relazioni
        graph.run("MATCH (pl:Platform) WHERE NOT (pl)-[]-() DELETE pl")

        # Elimina i nodi Arch senza relazioni
        graph.run("MATCH (a:Arch) WHERE NOT (a)-[]-() DELETE a")

        # Elimina i nodi Payload senza relazioni
        graph.run("MATCH (p:Payload) WHERE NOT (p)-[]-() DELETE p")

        graph.run("MATCH (p:Code) WHERE NOT (p)-[]-() DELETE p")

        # Elimina i nodi DefaultOptions senza relazioni
        graph.run("MATCH (d:DefaultOptions) WHERE NOT (d)-[]-() DELETE d")

        # Elimina i nodi Targets senza relazioni
        graph.run("MATCH (t:Targets) WHERE NOT (t)-[]-() DELETE t")

        # Elimina i nodi DisclosureDate senza relazioni
        graph.run("MATCH (d:DisclosureDate) WHERE NOT (d)-[]-() DELETE d")

        # Elimina i nodi Reference senza relazioni
        graph.run("MATCH (r:Reference) WHERE NOT (r)-[]-() DELETE r")

        # Elimina i nodi CVE senza relazioni
        graph.run("MATCH (c:CVE) WHERE NOT (c)-[]-() DELETE c")

        # Elimina i nodi BID senza relazioni
        graph.run("MATCH (b:BID) WHERE NOT (b)-[]-() DELETE b")

        # Elimina i nodi ZDI senza relazioni
        graph.run("MATCH (z:ZDI) WHERE NOT (z)-[]-() DELETE z")

        print(
            "Tutti i nodi e le relazioni creati dallo script sono stati cancellati dal database Neo4j."
        )

    except Exception as e:
        print(f"Errore imprevisto durante l'eliminazione dei dati: {e}")


# Esegui la funzione per eliminare i dati
delete_metasploit_data()
