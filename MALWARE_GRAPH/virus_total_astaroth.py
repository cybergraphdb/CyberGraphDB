import json
import requests
import logging

# Set up logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

# Replace with your VirusTotal API key
api_key = ""

url = "https://www.virustotal.com/api/v3/files/f7198035cce341240181d005c7b022e0"

headers = {
    "accept": "application/json",
    "x-apikey": api_key,
}

def fetch_virustotal_data(api_url, headers):
    try:
        response = requests.get(api_url, headers=headers)
        
        # Check if the request was successful
        if response.status_code == 200:
            data = response.json()
            logging.info("Response received successfully.")

            # Check for specific malware in the data
            if "Carberp" in str(data):
                logging.info("Let's go")
            
            # Extract information on "popular threat"
            popular_threat_classification = data["data"]["attributes"].get("popular_threat_classification", {})
            popular_threat_label = popular_threat_classification.get("suggested_threat_label", "Unknown")
            popular_threat_category = popular_threat_classification.get("popular_threat_category", [])
            popular_threat_name = popular_threat_classification.get("popular_threat_name", [])

            # Print results
            logging.info(f"Suggested Threat Label: {popular_threat_label}")
            logging.info("Popular Threat Categories:")
            for category in popular_threat_category:
                logging.info(f"- Category: {category['value']} Count: {category['count']}")
            logging.info("Popular Threat Names:")
            for name in popular_threat_name:
                logging.info(f"- Name: {name['value']} Count: {name['count']}")

        else:
            logging.error(f"Request failed with status code: {response.status_code}")
            logging.error(response.text)

    except Exception as e:
        logging.error(f"An error occurred: {str(e)}")

# Execute the function
fetch_virustotal_data(url, headers)
